@using Dfe.Data.SearchPrototype.Web.Models.ViewModels
@using Microsoft.AspNetCore.Mvc.Localization
@model SearchResults

@inject IViewLocalizer Localizer;
@{
    ViewData["Title"] = "Search Results";
    var searchKeyWord = ViewBag.SearchQuery as string;
}

@* search component *@
<form asp-action="Index" asp-controller="Home" method="get" id="search-establishments-form">
    <govuk-input input-class="govuk-input govuk-!-width-two-thirds" input-placeholder="Search by keyword" input-value="@searchKeyWord" name="searchKeyWord">
        <govuk-input-label is-page-heading="true" class="govuk-label--l" id="page-heading">Search</govuk-input-label>
        <govuk-input-hint>Search establishments</govuk-input-hint>
        <govuk-input-suffix style="padding: 0px">
            <button id="search" style="border: none; cursor:pointer">
                <svg class="gem-c-search__icon" width="27" height="27" viewBox="0 0 27 27" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false">
                    <circle cx="12.0161" cy="11.0161" r="8.51613" stroke="currentColor" stroke-width="3"></circle>
                    <line x1="17.8668" y1="17.3587" x2="26.4475" y2="25.9393" stroke="currentColor" stroke-width="3"></line>
                </svg>
            </button>
        </govuk-input-suffix>
    </govuk-input>
    @* end of search component *@
    @* filters *@
    @if (Model != null)
    {
        @if (Model.HasResults)
        {
            <div id="filters-container" class="govuk-grid-column-one-third">
                <h3 id="filters-heading">Filters</h3>
                <button type="submit" class="govuk-button" data-module="govuk-button">
                    Apply filters
                </button>
                <button id="clearFilters" type="submit" name="ClearFilters" value="true" class="govuk-button govuk-button--secondary" data-module="govuk-button">
                    Clear filters
                </button>
                @if (Model.Facets is not null && Model.Facets.Any())
                {
                    foreach (var facet in Model.Facets)
                    {
                        <govuk-checkboxes name="selectedFacets[@facet.Name]">
                            <govuk-checkboxes-fieldset id="FacetName-@facet.Name">
                                <govuk-checkboxes-fieldset-legend class="govuk-fieldset__legend--s">
                                    @Localizer[facet.Name]
                                </govuk-checkboxes-fieldset-legend>

                                @foreach (var facetValue in facet.Values)
                                {
                                    <govuk-checkboxes-item checked="@facetValue.IsSelected" value="@facetValue.Value">
                                        @facetValue.Value (@facetValue.Count)
                                    </govuk-checkboxes-item>
                                }
                            </govuk-checkboxes-fieldset>
                        </govuk-checkboxes>
                    }
                }
                else
                {
                    <p>No filters available</p>
                }
            </div>
        }
        @* end of filters *@
        @* display results *@
        @if (Model.HasResults)
        {
            <div class="govuk-grid-column-two-thirds" id="results">
                <h3 class="govuk-heading-m" id="search-results-count">@Model.SearchResultsCount @(Model.HasMoreThanOneResult ? "Results" : "Result")</h3>

                <nav class="govuk-pagination" role="navigation" aria-label="results">
                    @* @if (!(bool.Parse(Model.ViewModel.PaginationResponse.IsFirstPage)))
                    {
                        <div class="govuk-pagination__prev">
                            <a class="govuk-link govuk-pagination__link"
                               rel="prev"
                               href="@Url.Action(
                    (string)Model.ViewModel.PaginationRequest.ActionName,
                    (string)Model.ViewModel.PaginationRequest.ControllerName,
                new {
                    pagename = $"{Model.ViewModel.PaginationRequest.PageName}",
                    viewId =$"{Model.ViewModel.PaginationRequest.ViewId}",
                    pageNumber = (int.Parse(Model.ViewModel.PaginationResponse.CurrentPage) - 1)
                })">
                                <svg class="govuk-pagination__icon govuk-pagination__icon--prev"
                                     xmlns="http://www.w3.org/2000/svg" height="13" width="15"
                                     aria-hidden="true" focusable="false" viewBox="0 0 15 13">
                                    <path d="m6.5938-0.0078125-6.7266 6.7266 6.7441 6.4062 1.377-1.449-4.1856-3.9768h12.896v-2h-12.984l4.2931-4.293-1.414-1.414z"></path>
                                </svg>
                                <span class="govuk-pagination__link-title">
                                    @(Model.ViewContent.PreviousPageLabelText ?? "Previous")
                                </span>
                            </a>
                        </div>
                    } *@
                    @if (Model.PaginationResults?.PageSequences.Count > 0)
                    {
                        <ul class="govuk-pagination__list">
                            @if (!Model.PaginationResults.IsFirstPageSequence)
                            {
                                <li class="govuk-pagination__item govuk-pagination__item--ellipses">&ctdot;</li>
                            }
                            @foreach (var pageNumber in Model.PaginationResults.CurrentPageSequence)
                            {
                                if (pageNumber > 0)
                                {
                                    <li class="govuk-pagination__item
                                        @(pageNumber == Model.PaginationResults.CurrentPageNumber ? "govuk-pagination__item--current" : "")">


                                        <button type="submit" class="govuk-link govuk-pagination__link" name="PageNumber" value=@pageNumber>
                                            @pageNumber
                                        </button>

                                    @* <a class="govuk-link govuk-pagination__link"
                                            @if (pageNumber == Model.PaginationResults.CurrentPageNumber)
                                            {
                                                <text>aria-current="page"</text>
                                            }
                                            aria-label="@(("Page " + pageNumber))"
                                            type="submit"

                                                                    href="?ClearFilters=true"

                                            >
                                            @pageNumber
                                        </a> *@
                                    </li>
                                }
                            }
                            @if (!Model.PaginationResults.IsLastPageSequence)
                            {
                                <li class="govuk-pagination__item govuk-pagination__item--ellipses">&ctdot;</li>
                            }
                        </ul>
                    }
                    
                </nav>
                <hr />
                <ul style="list-style: none">
                    @foreach (var searchItem in Model.SearchItems!)
                    {
                        <li id="name-@searchItem.Urn">
                            <h4 style="background-color:aliceblue">
                                @searchItem.Name
                            </h4>
                        </li>
                        <li id="urn-@searchItem.Urn">
                            <strong>URN: </strong>@searchItem.Urn
                        </li>
                        <li id="address-@searchItem.Urn">
                            <strong>Address: </strong> @searchItem.ReadableAddress
                        </li>
                        <li id="establishment-type-@searchItem.Urn">
                            <strong>Type of establishment: </strong> @searchItem.EstablishmentType
                        </li>
                        <li id="establishment-status-@searchItem.Urn">
                            <strong>Status: </strong> @searchItem.EstablishmentStatusName
                        </li>
                        <li id="education-phase-@searchItem.Urn">
                            <strong>Education phase: </strong> @searchItem.PhaseOfEducation
                            <hr />
                        </li>
                    }
                </ul>
            </div>
        }
        else
        {
            <div class="govuk-grid-column-two-thirds" id="no-results">
                <p>Sorry no results found please amend your search criteria</p>
            </div>
        }
        @*  end of list component *@
    }
    @* end of display results *@
</form>